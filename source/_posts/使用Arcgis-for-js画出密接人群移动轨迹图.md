---
title: 使用Arcgis for js画出密接人群移动轨迹图
date: 2021-12-06 21:29:32
tags: [arcgis,vue,web]
thumbnail: https://satt.oss-cn-hangzhou.aliyuncs.com/img/image-20211206213201817.png
---

前段时间，做了个小项目。其中一个主要的需求是要根据真实经纬度的路径来可视化行程，目的是画出密接人群。写完后记录一下（虽然已经过去大半个月了）。

## 构思

考虑到实用性，需要用到真实的地图来显示行程。一开始我是想到使用Arcgis绘制地图。不过做了一部分后，发现用高德地图、百度地图等的API也可以做，对于这种体量的项目来说并不需要用到ArcgisForJS。不过……写都写了。

有了地图，我们可以将上述需求分为三个小点，分别是：*产生路径*、*画出动画*、*判断密接*。

### 产生路径

首先是产生路径。由于理论上该项目是要展示真实的疫情，但目前没有数据。因此我需要先自行创建一系列*随机*的路径。但又不能过于*随机*，出现小点不沿着路行走的情况。经过一番查找，我发现可以地图服务商（高德地图、百度地图等）提供的路径规划功能。通过WebAPI，发送终点和起点，就会返回对应路径的经纬度信息。不过，对于起点和终点，似乎不好确定。一个简单的想法是手动在地图上打点，记录下不同位置的经纬度，到时候随机选取两个分别作为起点和终点即可。用来模拟应该足够了，不错，路径有了。

### 画动画

在解决路径后，接下去就是要根据路径画出小点来。通过查找Arcgis for js的文档，发现它确实有提供根据经纬度画点的API，不错！至于动画，似乎可以通过JS的SetInterval，即设置一个定时器来画出动画。在每一帧都更新点的位置即可。不过似乎要考虑*性能*问题。

### 密接判定

最后是密接人群的判定。由于不需要考虑真实科学的传染方式，那么一个简单的思路就是根据距离判断，在定时器上添加一个距离判定，如果在某个半径内，就判定为密接，同时改变小点的颜色以示区分。

思路有了，接下去就是实现了。

## 实现

待续……

### 地图的绘制





![传染啊啊](https://satt.oss-cn-hangzhou.aliyuncs.com/img/传染啊啊.gif)
